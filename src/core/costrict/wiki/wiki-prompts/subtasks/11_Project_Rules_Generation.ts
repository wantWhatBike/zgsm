import { GENERAL_RULES_OUTPUT_DIR, WIKI_OUTPUT_DIR, SUBTASK_OUTPUT_FILENAMES } from "./constants"

export const PROJECT_RULES_GENERATION_TEMPLATE = `# 项目规则生成任务
## 任务描述
基于项目代码仓库深度分析，生成项目特异性的开发编码和测试约束规则文档。专注于"项目特有的，必须强制遵守的，不遵守会引起bug、系统崩溃、运行失败、项目架构风格破坏"的具体实施约束。

## 🔴 核心约束（必须严格遵守）

**文档长度**: 总长度严格控制在100行以内
**规则描述**: 每条规则一行完成，不超过50字
**具体要求**: 必须包含具体数值、路径、版本或格式
**禁止内容**: 抽象原则、通用最佳实践、代码片段

## 输入要求

- **项目索引**: ${WIKI_OUTPUT_DIR}${SUBTASK_OUTPUT_FILENAMES.INDEX_GENERATION_TASK_FILE}（优先读取）
- **技术文档**: ${WIKI_OUTPUT_DIR} 目录下相关分析文档
- **代码仓库**: 最多30个核心文件，跳过.roo、测试、临时文件

## 规则类别（选择性应用，可扩充）

### 开发约束（75%）
- **依赖管理**: 版本锁定、包管理、依赖注入配置等等
- **代码组织**: 目录结构、命名规范、文件组织等等
- **数据库**: 连接池、事务、查询优化、迁移等等
- **API开发**: 请求处理、响应格式、认证授权等等
- **错误处理**: 异常分类、错误码、日志记录等等
- **性能**: 响应时间、吞吐量、资源使用等等

### 测试约束（15%）
- **单元测试**: Mock框架、覆盖率、文件组织等等
- **集成测试**: 环境配置、数据库测试、依赖Mock等等
- **接口测试**: 认证、参数验证、响应验证等等

### 运维约束（10%）
- **配置管理**: 环境配置、敏感信息、更新机制等等
- **部署**: 容器化、编排、监控集成等等

## 输出格式

\`\`\`markdown
# {项目名称} 开发规范

## 依赖管理
- 🔴 必须使用React 18.2.0版本，禁止升级到19.x
- 🟡 所有依赖必须在package.json中锁定具体版本号

## 代码组织
- 🔴 组件必须放在src/components目录，按功能分子目录
- 🟡 工具函数必须放在src/utils目录，使用kebab-case命名

## 错误处理
- 🔴 异步操作必须使用try-catch，错误记录到日志系统
- 🟡 业务异常必须抛出BusinessException包含错误码

## 测试要求
- 🔴 单元测试必须使用vitest，文件命名*.test.ts
- 🟡 核心业务逻辑测试覆盖率不低于80%

## 数据库操作（如适用）
- 🔴 连接池最大连接数20，超时时间30秒
- 🟡 查询必须使用prepared statements防SQL注入

## API开发（如适用）
- 🔴 响应必须包含requestId字段，格式UUID v4
- 🟡 API路径必须使用RESTful风格，版本号在URL中

## 安全约束（如适用）
- 🔴 用户输入必须HTML转义防XSS攻击
- 🟡 JWT token过期时间设置为2小时

## 性能约束（如适用）
- 🔴 API响应时间不超过500ms，超时返回504
- 🟡 缓存命中率必须达到85%以上

## 环境配置
- 🔴 环境变量必须使用MYAPP_前缀
- 🟡 配置文件使用.env格式，敏感信息不提交代码库
\`\`\`

## 优先级标记

- 🔴 关键约束：违反导致系统故障或安全问题
- 🟡 重要约束：违反影响性能或可维护性
- 🟢 建议约束：违反影响代码质量

## 规则要求

**必须包含**:
- 具体配置值（端口、超时、连接数等）
- 具体文件路径（目录结构、配置位置）
- 具体命名规范（变量、文件、API路径）
- 具体版本要求（依赖版本、框架版本）
- 具体格式要求（日志、响应、配置格式）

**绝对禁止**:
- 抽象设计原则（"保持代码简洁"）
- 通用最佳实践（"使用有意义变量名"）
- 模糊建议（"适当使用缓存"）
- 无法验证约束（"代码易于理解"）
- 代码片段或示例
- 通用编程建议

## 输出文件
\`${GENERAL_RULES_OUTPUT_DIR}${SUBTASK_OUTPUT_FILENAMES.PROJECT_RULES_TASK_FILE}\`

## 格式约束

1. **标题层级**: 一级标题 -> 二级标题 -> 规则列表
2. **规则格式**: "- 优先级标记 规则描述"
3. **禁止使用**: 三级标题、额外章节、代码片段
4. **长度控制**: 总长度100行内，单条规则50字内
`